<p align="center">
  <img src="https://capsule-render.vercel.app/api?type=wave&height=200&color=0:FFD86F,50:FFAA28,100:FF6B00&text=SKN-3RD-5TEAM&fontSize=47&fontColor=FFFFFF&section=header&desc=RAG%20Pipeline%20for%20Shelter%20and%20Disaster%20Guidelines&descSize=15" />
</p>

<p align="center">
  ğŸ“Œ <strong>ë¯¼ë°©ìœ„ ëŒ€í”¼ì‹œì„¤ + ì¬ë‚œ í–‰ë™ìš”ë ¹ ë°ì´í„° ê¸°ë°˜ RAG & ì±—ë´‡ ì‹œìŠ¤í…œ</strong><br>
  <sub>SK Networks Family 20ê¸° â€” 3RD 5TEAM</sub>
</p>

<p align="center">
  ğŸ” <strong>CSV + JSON â†’ LangChain Document â†’ Embedding â†’ ChromaDB â†’ LangGraph Agent â†’ FastAPI + Web UI</strong>
</p>

---

## ğŸ‘¥ íŒ€êµ¬ì„±

| <img src="./image/ì¿¼ì¹´.jpeg" width="150"> <br> ë¬¸ì°½êµ |  <img src="./image/dak.jpeg" width="150"> <br> ê¶Œê·œë¦¬ |  <img src="./image/rich.jpeg" width="150"> <br> ê¹€í™©í˜„ |  <img src="./image/loopy.jpeg" width="150"> <br> ê¹€íš¨ë¹ˆ |  <img src="./image/ham.jpeg" width="150"> <br> ì´ìŠ¹ê·œ |
|:------:|:------:|:------:|:------:|:------:|
| <a href="https://github.com/mck1902"><img src="https://img.shields.io/badge/GitHub-mck1902-blue?logo=github"></a> | <a href="https://github.com/gyur1eek"><img src="https://img.shields.io/badge/GitHub-gyur1eek-yellow?logo=github"></a> | <a href="https://github.com/hyun2kim"><img src="https://img.shields.io/badge/GitHub-khyun2kim-green?logo=github"></a> | <a href="https://github.com/kimobi"><img src="https://img.shields.io/badge/GitHub-kimobi-pink?logo=github"></a> | <a href="https://github.com/neobeauxarts"><img src="https://img.shields.io/badge/GitHub-neobeauxarts-lightblue?logo=github"></a> |

---

## ğŸ’» ê¸°ìˆ  ìŠ¤íƒ

| ë¶„ë¥˜ | ì‚¬ìš© ê¸°ìˆ  |
|------|-----------|
| ì–¸ì–´ | ![Python](https://img.shields.io/badge/Python-3776AB.svg?style=flat&logo=python&logoColor=white) Python |
| í”„ë¡ íŠ¸ì—”ë“œ | ![HTML5](https://img.shields.io/badge/HTML5-E34F26.svg?style=flat&logo=html5&logoColor=white) HTML<br>![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E.svg?style=flat&logo=javascript&logoColor=black) JavaScript<br>![TailwindCSS](https://img.shields.io/badge/Tailwind-06B6D4.svg?style=flat&logo=tailwindcss&logoColor=white) TailwindCSS |
| ë°±ì—”ë“œ | ![FastAPI](https://img.shields.io/badge/FastAPI-009688.svg?style=flat&logo=fastapi&logoColor=white) FastAPI |
| AI í”„ë ˆì„ì›Œí¬ | ![LangChain](https://img.shields.io/badge/LangChain-1E8C7E.svg?style=flat&logo=chainlink&logoColor=white) LangChain<br>![LangGraph](https://img.shields.io/badge/LangGraph-1E8C7E.svg?style=flat&logo=chainlink&logoColor=white) LangGraph |
| LLM | ![OpenAI](https://img.shields.io/badge/OpenAI%20GPT--4o--mini-000000.svg?style=flat&logo=openai&logoColor=white) GPT-4o-mini |
| ì„ë² ë”© ëª¨ë¸ | ![OpenAI](https://img.shields.io/badge/OpenAI%20Embedding-000000.svg?style=flat&logo=openai&logoColor=white) text-embedding-3-small |
| ë²¡í„° DB | ![ChromaDB](https://img.shields.io/badge/ChromaDB-16C47F.svg?style=flat&logo=databricks&logoColor=white) ChromaDB |
| ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜ | ![Dense Retrieval](https://img.shields.io/badge/Dense%20Retrieval-4A90E2.svg?style=flat) Dense Retrieval (Vector Search)<br>![BM25](https://img.shields.io/badge/BM25-00A98F.svg?style=flat) BM25 (Sparse Retrieval)<br>![Hybrid Search](https://img.shields.io/badge/Hybrid%20Search-FF6F61.svg?style=flat) Ensemble Hybrid Search |
| ì™¸ë¶€ API | ![Kakao API](https://img.shields.io/badge/Kakao%20Local%20API-FFCD00.svg?style=flat&logo=kakao&logoColor=black) Kakao Local API (ìœ„ì¹˜ ê²€ìƒ‰)<br>![Naver Maps](https://img.shields.io/badge/Naver%20Maps%20API-03C75A.svg?style=flat&logo=naver&logoColor=white) Naver Maps API (ì§€ë„ ì‹œê°í™”)<br>![Naver Panorama](https://img.shields.io/badge/Naver%20Panorama%20API-03C75A.svg?style=flat&logo=naver&logoColor=white) Naver Panorama API (ê±°ë¦¬ë·°) |
| ë°ì´í„° ì „ì²˜ë¦¬ | ![Pandas](https://img.shields.io/badge/Pandas-150458.svg?style=flat&logo=pandas&logoColor=white) pandas |
| í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ | ![Dotenv](https://img.shields.io/badge/Dotenv-9ACD32.svg?style=flat&logo=dotenv&logoColor=white) python-dotenv (.env) |


---

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”

ë³¸ í”„ë¡œì íŠ¸ëŠ” **ë¯¼ë°©ìœ„ ëŒ€í”¼ ì‹œì„¤(CSV)** ê³¼ **ì¬ë‚œ í–‰ë™ìš”ë ¹(JSON)** ë°ì´í„°ë¥¼ í†µí•©í•˜ì—¬  
**LangGraph Agent ê¸°ë°˜ RAG(Retrieval-Augmented Generation)** ì‹œìŠ¤í…œê³¼ **FastAPI + ì›¹ ì¸í„°í˜ì´ìŠ¤** ê¸°ë°˜ ì‹¤ì‹œê°„ ì±—ë´‡ì„ êµ¬ì¶•í•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

ì‚¬ìš©ìëŠ” **HTML/JavaScript ê¸°ë°˜ ì›¹ ì¸í„°í˜ì´ìŠ¤**ì—ì„œ  
ì¬ë‚œ ìƒí™©ì— ëŒ€í•œ ì§ˆë¬¸ ë˜ëŠ” ëŒ€í”¼ì†Œ ìœ„ì¹˜ ê´€ë ¨ ì§ˆì˜ë¥¼ ì…ë ¥í•˜ë©´  
**í•˜ì´ë¸Œë¦¬ë“œ ë²¡í„° ê²€ìƒ‰(Dense + BM25)** ê¸°ë°˜ìœ¼ë¡œ **ê·¼ê±° ê¸°ë°˜ ë‹µë³€**ì„ ì œê³µí•˜ê³ , **Naver ì§€ë„ì— ëŒ€í”¼ì†Œ ìœ„ì¹˜ë¥¼ ì‹œê°í™”**í•©ë‹ˆë‹¤.

### ğŸ¯ í•µì‹¬ ê¸°ëŠ¥

1. **LangGraph Agent ì•„í‚¤í…ì²˜**
   - ì˜ë„ ë¶„ë¥˜ (Intent Classification)
   - ì§ˆë¬¸ ì¬ì •ì˜ (Query Rewriting)
   - ë„êµ¬ ê¸°ë°˜ ë©€í‹° í„´ ëŒ€í™” (Tool-based Multi-turn)
   - ë©”ëª¨ë¦¬ ê¸°ë°˜ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ìœ ì§€

2. **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì‹œìŠ¤í…œ**
   - Dense Retrieval: OpenAI ì„ë² ë”© ê¸°ë°˜ ì˜ë¯¸ ê²€ìƒ‰
   - BM25: í‚¤ì›Œë“œ ê¸°ë°˜ ì •í™•ë„ ê²€ìƒ‰
   - Ensemble Weighting: ë‘ ë°©ì‹ì˜ ê°€ì¤‘ í‰ê· 

3. **ë³µí•© ì§ˆë¬¸ ì²˜ë¦¬**
   - "ì„¤ì•…ì‚° ê·¼ì²˜ì¸ë° ì‚°ì‚¬íƒœ ë°œìƒ ì‹œ" â†’ ìœ„ì¹˜ ê²€ìƒ‰ + ì¬ë‚œ í–‰ë™ìš”ë ¹
   - "ë™ëŒ€ë¬¸ë§¨ì…˜ ìˆ˜ìš©ì¸ì›" â†’ ì‹œì„¤ëª… ì§ì ‘ ê²€ìƒ‰
   - "ê°•ë‚¨ì—­ ê·¼ì²˜ ëŒ€í”¼ì†Œ" â†’ GPS ê¸°ë°˜ ê±°ë¦¬ ê³„ì‚°

4. **ì‹¤ì‹œê°„ ì§€ë„ ì‹œê°í™”**
   - Kakao Local API: ì§€ëª… â†’ ì¢Œí‘œ ë³€í™˜
   - Naver Maps API: ëŒ€í”¼ì†Œ ë§ˆì»¤ í‘œì‹œ
   - Naver Panorama API: ê±°ë¦¬ë·° ì œê³µ
   - GPS ê¸°ë°˜ í˜„ìœ„ì¹˜ ê²€ìƒ‰

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
SKN20-3RD-5TEAM/
â”œâ”€â”€ data/                           # ë°ì´í„° ë””ë ‰í† ë¦¬
â”‚   â”œâ”€â”€ shelter.csv                 # ë¯¼ë°©ìœ„ ëŒ€í”¼ì‹œì„¤ ë°ì´í„°
â”‚   â”œâ”€â”€ natural_disaster/*.json     # ìì—°ì¬ë‚œ í–‰ë™ìš”ë ¹
â”‚   â””â”€â”€ social_disaster/*.json      # ì‚¬íšŒì¬ë‚œ í–‰ë™ìš”ë ¹
â”‚
â”œâ”€â”€ chroma_db/                      # ChromaDB ì˜êµ¬ ì €ì¥ì†Œ
â”‚
â”œâ”€â”€ shelter_chatbot/
â”‚   â””â”€â”€ cert/                       # SSL ì¸ì¦ì„œ ë””ë ‰í† ë¦¬
â”‚       â”œâ”€â”€ cert.pem
â”‚       â””â”€â”€ key.pem
â”‚
â”œâ”€â”€ data_loaders.py                 # ë°ì´í„° ë¡œë“œ ëª¨ë“ˆ
â”œâ”€â”€ documents.py                    # Document ë³€í™˜ ëª¨ë“ˆ
â”œâ”€â”€ embedding_and_vectordb.py       # ì„ë² ë”© ë° VectorDB ìƒì„±
â”œâ”€â”€ from_DataLoad_to_VectorDB.py    # ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (ì´ˆê¸°í™”)
â”œâ”€â”€ langgraph_agent.py              # LangGraph Agent ë° Tools ì •ì˜
â”œâ”€â”€ main.py                         # FastAPI ì„œë²„
â”œâ”€â”€ shelter_1.0.html                # ì›¹ í”„ë¡ íŠ¸ì—”ë“œ
â””â”€â”€ generate_ssl_cert.py            # SSL ì¸ì¦ì„œ ìë™ ìƒì„±
```

---

## ğŸš€ ì„¤ì¹˜ & ì‹¤í–‰

### 0ï¸âƒ£ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
pip install -r requirements.txt
```

**ì£¼ìš” íŒ¨í‚¤ì§€:**

| ì¹´í…Œê³ ë¦¬ | íŒ¨í‚¤ì§€ | ì—­í•  |
|---------|--------|------|
| **ì›¹ í”„ë ˆì„ì›Œí¬** | `fastapi` | REST API ì„œë²„ êµ¬ì¶• |
| | `uvicorn` | ASGI ì„œë²„ ì‹¤í–‰ |
| | `pydantic` | ë°ì´í„° ê²€ì¦ ë° ì§ë ¬í™” |
| **AI/LLM** | `langchain` | LLM í”„ë ˆì„ì›Œí¬ í•µì‹¬ |
| | `langchain-openai` | OpenAI API í†µí•© |
| | `langchain-community` | ì»¤ë®¤ë‹ˆí‹° ë„êµ¬ (BM25 ë“±) |
| | `langchain-chroma` | ChromaDB ì—°ë™ |
| | `langchain-core` | LangChain í•µì‹¬ ëª¨ë“ˆ |
| | `langgraph` | Agent ìƒíƒœ ê¸°ë°˜ ê·¸ë˜í”„ |
| | `openai` | OpenAI Python SDK |
| **ë²¡í„° DB** | `chromadb` | ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ |
| **ë°ì´í„° ì²˜ë¦¬** | `pandas` | í…Œì´ë¸” ë°ì´í„° ì²˜ë¦¬ |
| | `numpy` | ìˆ˜ì¹˜ ì—°ì‚° |
| **ë„¤íŠ¸ì›Œí¬** | `requests` | HTTP ìš”ì²­ (Kakao API) |
| | `httpx` | ë¹„ë™ê¸° HTTP í´ë¼ì´ì–¸íŠ¸ |
| **í™˜ê²½ ê´€ë¦¬** | `python-dotenv` | .env íŒŒì¼ ë¡œë“œ |
| **ë³´ì•ˆ** | `cryptography` | SSL ì¸ì¦ì„œ ìƒì„± |
---

### 1ï¸âƒ£ í™˜ê²½ë³€ìˆ˜ ì„¤ì • (.env)
```bash
OPENAI_API_KEY=your_openai_api_key_here
KAKAO_REST_API_KEY=your_kakao_rest_api_key_here
```

---

### 2ï¸âƒ£ VectorDB ì´ˆê¸°í™” (ìµœì´ˆ 1íšŒë§Œ ì‹¤í–‰)

#### ğŸ“„ `from_DataLoad_to_VectorDB.py` (ë°ì´í„° íŒŒì´í”„ë¼ì¸ í†µí•© ì‹¤í–‰)

**ëª©ì :** ì›ë³¸ ë°ì´í„°ë¥¼ VectorDBë¡œ ë³€í™˜í•˜ëŠ” ì „ì²´ íŒŒì´í”„ë¼ì¸ì„ í•œ ë²ˆì— ì‹¤í–‰

**ì‹¤í–‰:**
```bash
python from_DataLoad_to_VectorDB.py
```

**ë‚´ë¶€ ë™ì‘ ìˆœì„œ:**

1. **`data_loaders.py` í˜¸ì¶œ - ë°ì´í„° ë¡œë“œ**
   - `load_shelter_csv(csv_file, data_dir)`: CSV íŒŒì¼ì„ pandas DataFrameìœ¼ë¡œ ë¡œë“œ
   - `load_disaster_json(path)`: ë‹¨ì¼ JSON íŒŒì¼ì„ dictë¡œ ë¡œë“œ
   - `load_all_disaster_jsons(json_files, data_dir)`: ì—¬ëŸ¬ JSON íŒŒì¼ì„ ì¼ê´„ ë¡œë“œ

2. **`documents.py` í˜¸ì¶œ - Document ë³€í™˜**
   - `csv_to_documents(shelter_data)`: 
     - ëŒ€í”¼ì†Œ DataFrameì„ LangChain Document ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
     - ê° í–‰ì„ ìì—°ì–´ í…ìŠ¤íŠ¸(`page_content`)ë¡œ ë³€í™˜
     - ë©”íƒ€ë°ì´í„° ì¶”ì¶œ (ì‹œì„¤ëª…, ì£¼ì†Œ, ì¢Œí‘œ, ìˆ˜ìš©ì¸ì› ë“±)
   
   - `json_to_documents(disaster_datas)`:
     - ì¬ë‚œ í–‰ë™ìš”ë ¹ JSONì„ LangChain Document ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
     - `parse_node()` í•¨ìˆ˜ë¡œ ê³„ì¸µì  JSON êµ¬ì¡°ë¥¼ ì¬ê·€ íƒìƒ‰
     - ì„¸ë¶€ì‚¬í•­, ì£¼ì˜ì‚¬í•­, í–‰ë™ìš”ë ¹ ë“±ì„ í¬í•¨í•œ Document ìƒì„±

3. **`embedding_and_vectordb.py` í˜¸ì¶œ - ì„ë² ë”© ë° ì €ì¥**
   - `create_embeddings_and_vectordb(documents)`:
     - OpenAI `text-embedding-3-small` ëª¨ë¸ë¡œ ì„ë² ë”© ìƒì„±
     - ChromaDBì— Document + ì„ë² ë”© ì €ì¥
     - ì»¬ë ‰ì…˜ëª…: `shelter_and_disaster_guidelines`
     - ì €ì¥ ê²½ë¡œ: `./chroma_db/`

**ë°ì´í„° ë³€í™˜ ê³¼ì •:**
```
[ì›ë³¸ ë°ì´í„°]
â”œâ”€â”€ shelter.csv (DataFrame)
â”‚   â””â”€â”€ csv_to_documents()
â”‚       â””â”€â”€ List[Document(page_content, metadata)] ---- ['shelter' Documents]
â”‚
â””â”€â”€ *.json (dict)
    â””â”€â”€ json_to_documents()
        â””â”€â”€ List[Document(page_content, metadata)] ---- ['guidline' Documents]

â†“ (í†µí•©)

['shelter' Documents] + ['guidline' Documents] â†’ [All Documents]

â†“ (ì„ë² ë”©)

[OpenAI Embeddings] â†’ Vector[1536ì°¨ì›]

â†“ (ì €ì¥)

[ChromaDB] â†’ ./chroma_db/
```

---

### 3ï¸âƒ£ FastAPI ì„œë²„ ì‹¤í–‰

#### ğŸ“„ `main.py` (API ì„œë²„ ë° ìš”ì²­ ì²˜ë¦¬)

**ëª©ì :** ì‚¬ìš©ì ìš”ì²­ì„ ë°›ì•„ LangGraph Agentì— ì „ë‹¬í•˜ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” FastAPI ì„œë²„

**ì‹¤í–‰:**
```bash
python main.py
```

**í•µì‹¬ êµ¬ì„±ìš”ì†Œ:**

1. **Lifespan ì´ˆê¸°í™” (`@asynccontextmanager async def lifespan`)**
   - ì„œë²„ ì‹œì‘ ì‹œ ì‹¤í–‰:
     - OpenAI ì„ë² ë”© ëª¨ë¸ ì´ˆê¸°í™”
     - ChromaDB ë¡œë“œ (`./chroma_db/`)
     - ëŒ€í”¼ì†Œ CSV ë°ì´í„° ë¡œë“œ
     - `langgraph_agent.py`ì˜ `create_langgraph_app()` í˜¸ì¶œí•˜ì—¬ Agent ì´ˆê¸°í™”

2. **ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸:**

   - `POST /api/location/extract`:
     - ì‚¬ìš©ì ì¿¼ë¦¬ë¥¼ ë°›ì•„ LangGraph Agent ì‹¤í–‰
     - Agentì˜ `structured_data` ì¶”ì¶œ (ì§€ë„ í‘œì‹œìš©)
     - ì‘ë‹µ ë°˜í™˜ (`LocationExtractResponse`)
   
   - `GET /api/shelters/nearest`:
     - GPS ì¢Œí‘œ ê¸°ë°˜ ê°€ì¥ ê°€ê¹Œìš´ ëŒ€í”¼ì†Œ ê²€ìƒ‰
     - Haversine ê³µì‹ìœ¼ë¡œ ê±°ë¦¬ ê³„ì‚°
     - ChromaDB ë©”íƒ€ë°ì´í„° í•„í„°ë§
   
   - `GET /`: 
     - `shelter_1.0.html` íŒŒì¼ ì œê³µ (ì›¹ UI)
   
   - `GET /api/health`, `GET /api/status`:
     - ì„œë²„ ìƒíƒœ í™•ì¸

3. **CORS ë¯¸ë“¤ì›¨ì–´:**
   - ëª¨ë“  ë„ë©”ì¸ì—ì„œì˜ API í˜¸ì¶œ í—ˆìš©

---

#### ğŸ“„ `langgraph_agent.py` (Agent ë¡œì§ ë° ë„êµ¬ ì •ì˜)

**ëª©ì :** ìˆœìˆ˜í•˜ê²Œ "ìƒê°í•˜ëŠ” ë¡œì§"ë§Œ ë‹´ë‹¹ - ì˜ë„ ë¶„ë¥˜, ì§ˆë¬¸ ì¬ì •ì˜, ë„êµ¬ ì„ íƒ ë° ì‹¤í–‰

**í•µì‹¬ êµ¬ì„±ìš”ì†Œ:**

1. **`create_hybrid_retrievers(vectorstore)` - í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ê¸° ìƒì„±**
   - Vector Retriever: ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ (OpenAI ì„ë² ë”©)
   - BM25 Retriever: í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰
   - `EnsembleRetriever`: ë‘ ë°©ì‹ì„ ê°€ì¤‘ í‰ê· ìœ¼ë¡œ ê²°í•© (Vector 60-70%, BM25 30-40%)

2. **`create_langgraph_app(vectorstore)` - LangGraph Agent ìƒì„±**

   **LLM ì´ˆê¸°í™”:**
   - `llm`: GPT-4o-mini (temperature=0, ì •í™•í•œ ë¶„ë¥˜ìš©)
   - `llm_creative`: GPT-4o-mini (temperature=0.7, ì¼ë°˜ ì§€ì‹ ë‹µë³€ìš©)

   **Chain ì •ì˜:**
   - `intent_classification_prompt + llm`: ì‚¬ìš©ì ì§ˆë¬¸ì„ 8ê°œ ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ë¥˜
     - `hybrid_location_disaster`, `shelter_info`, `shelter_search`, `shelter_count`, 
     - `shelter_capacity`, `disaster_guideline`, `general_knowledge`, `general_chat`
   
   - `query_rewrite_prompt + llm`: BM25 ê²€ìƒ‰ ìµœì í™”ë¥¼ ìœ„í•œ ì¿¼ë¦¬ ì¬ì‘ì„±
     - í•µì‹¬ í‚¤ì›Œë“œ ì¶”ì¶œ, ë™ì˜ì–´ ì¶”ê°€, ì§€ì—­ëª… í™•ì¥

   **Tools (7ê°€ì§€ ë„êµ¬) ì •ì˜:**

   - **`@tool search_shelter_by_location(query)`**
     - Kakao Local APIë¡œ ì§€ëª… â†’ ì¢Œí‘œ ë³€í™˜
     - ChromaDBì—ì„œ ëª¨ë“  ëŒ€í”¼ì†Œ ë©”íƒ€ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
     - Haversine ê³µì‹ìœ¼ë¡œ ê±°ë¦¬ ê³„ì‚°
     - ê°€ê¹Œìš´ 5ê³³ ë°˜í™˜ + `structured_data` (ì§€ë„ í‘œì‹œìš©)

   - **`@tool search_shelter_by_name(query)`** 
     - ì‹œì„¤ëª… ë¶€ë¶„ ì¼ì¹˜ ê²€ìƒ‰
     - ë©”íƒ€ë°ì´í„°ì—ì„œ `facility_name` í•„í„°ë§
     - ìˆ˜ìš©ì¸ì›, ì£¼ì†Œ ë“± ìƒì„¸ ì •ë³´ ë°˜í™˜

   - **`@tool search_location_with_disaster(query)`** 
     - ë³µí•© ì§ˆë¬¸ ì²˜ë¦¬ (ìœ„ì¹˜ + ì¬ë‚œ)
     - ì¬ë‚œ í‚¤ì›Œë“œ ì¶”ì¶œ â†’ ìœ„ì¹˜ ê²€ìƒ‰ â†’ ëŒ€í”¼ì†Œ ê²€ìƒ‰ + í–‰ë™ìš”ë ¹ ê²€ìƒ‰
     - í†µí•© ê²°ê³¼ ë°˜í™˜

   - **`@tool count_shelters(query)`**
     - ì¡°ê±´ì— ë§ëŠ” ëŒ€í”¼ì†Œ ê°œìˆ˜ ì„¸ê¸°
     - Hybrid Retriever ì‚¬ìš©

   - **`@tool search_shelter_by_capacity(query)`**
     - ìˆ˜ìš©ì¸ì› ê¸°ì¤€ ê²€ìƒ‰
     - ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ìˆ«ì ì¶”ì¶œ
     - ë©”íƒ€ë°ì´í„° í•„í„°ë§

   - **`@tool search_disaster_guideline(query)`**
     - ì¬ë‚œ í–‰ë™ìš”ë ¹ ê²€ìƒ‰
     - Hybrid Retriever ì‚¬ìš©
     - ìƒìœ„ 3ê°œ ê²°ê³¼ í†µí•©

   - **`@tool answer_general_knowledge(query)`**
     - ì¼ë°˜ ì§€ì‹ ì§ˆë¬¸ ë‹µë³€
     - LLM ì‚¬ì „ í•™ìŠµ ì§€ì‹ í™œìš© (VectorDB ë¯¸ì‚¬ìš©)

   **State ì •ì˜:**
   ```python
   class AgentState(TypedDict):
       messages: List[BaseMessage]
       intent: str
       rewritten_query: str
       structured_data: Optional[dict]  # ì§€ë„ í‘œì‹œìš©
   ```

   **Node í•¨ìˆ˜:**
   - `intent_classifier_node`: ì˜ë„ ë¶„ë¥˜
   - `query_rewrite_node`: ì§ˆë¬¸ ì¬ì •ì˜
   - `agent_node`: ë„êµ¬ ì„ íƒ ë° ì‹¤í–‰ ê³„íš
   - `tools_node_with_structured_data`: ë„êµ¬ ì‹¤í–‰ ë° êµ¬ì¡°í™”ëœ ë°ì´í„° ì¶”ì¶œ

   **Graph êµ¬ì¡°:**
   ```
   START â†’ intent_classifier â†’ query_rewrite â†’ agent â‡„ tools â†’ END
   ```

   **Memory:**
   - `MemorySaver`: ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ìœ ì§€ (ì„¸ì…˜ ID ê¸°ë°˜)

---

#### ğŸ“„ `shelter_1.0.html` (í”„ë¡ íŠ¸ì—”ë“œ - ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤)

**ëª©ì :** ì‚¬ìš©ìê°€ ì§ˆë¬¸ì„ ì…ë ¥í•˜ê³  ê²°ê³¼ë¥¼ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•˜ëŠ” ì›¹ í˜ì´ì§€

**í•µì‹¬ ê¸°ëŠ¥:**

1. **API í˜¸ì¶œ:**
   - `POST /api/location/extract`: ì‚¬ìš©ì ì¿¼ë¦¬ ì „ì†¡
   - `GET /api/shelters/nearest`: GPS ì¢Œí‘œ ê¸°ë°˜ ê²€ìƒ‰

2. **Naver Maps API ì—°ë™:**
   - ëŒ€í”¼ì†Œ ë§ˆì»¤ í‘œì‹œ
   - ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ í‘œì‹œ
   - InfoWindowë¡œ ìƒì„¸ ì •ë³´ í‘œì‹œ

3. **Naver Panorama API ì—°ë™:** 
   - ì§€ë„ í´ë¦­ ì‹œ í•´ë‹¹ ìœ„ì¹˜ì˜ ê±°ë¦¬ë·° í‘œì‹œ
   - ì§€ë„ ì˜ì—­ê³¼ íŒŒë…¸ë¼ë§ˆ ì˜ì—­ì„ 50%/50%ë¡œ ë¶„í• 
   - ë§ˆì»¤ í´ë¦­ ì‹œ í•´ë‹¹ ìœ„ì¹˜ì˜ íŒŒë…¸ë¼ë§ˆ ìë™ í‘œì‹œ

4. **GPS ìœ„ì¹˜ ì •ë³´:**
   - `navigator.geolocation.getCurrentPosition()` ì‚¬ìš©
   - ì‹¤ì‹œê°„ í˜„ìœ„ì¹˜ ê²€ìƒ‰
   - í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ í˜„ìœ„ì¹˜ í‘œì‹œ 

5. **í˜„ìœ„ì¹˜ ê¸°ë°˜ ê¸°ëŠ¥ ê°•í™”:** 
   - `currentUserPosition` ì „ì—­ ë³€ìˆ˜ë¡œ í˜„ìœ„ì¹˜ ì €ì¥
   - `resetMapToCurrentLocation()` í•¨ìˆ˜ë¡œ ì§€ë„ ì •ë³´ ì—†ì„ ë•Œ í˜„ìœ„ì¹˜ë¡œ ë¦¬ì…‹
   - ëŒ€í”¼ì†Œ ì •ë³´ ì—†ëŠ” ì‘ë‹µ ì‹œ ìë™ìœ¼ë¡œ í˜„ìœ„ì¹˜ ì§€ë„ í‘œì‹œ

---

### 4ï¸âƒ£ SSL ì¸ì¦ì„œ ìƒì„± (ì„ íƒì‚¬í•­ - HTTPS í•„ìš” ì‹œ)

#### ğŸ“„ `generate_ssl_cert.py` (SSL ì¸ì¦ì„œ ìë™ ìƒì„±)

**ëª©ì :** HTTPS ì„œë²„ êµ¬ë™ì„ ìœ„í•œ ìê°€ ì„œëª… ì¸ì¦ì„œ ìƒì„±

**ì‹¤í–‰:**
```bash
python generate_ssl_cert.py
```

**ì£¼ìš” ê¸°ëŠ¥:**
- `cryptography` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ RSA 4096-bit ê°œì¸í‚¤ ìƒì„±
- X.509 ì¸ì¦ì„œ ìƒì„± (ìœ íš¨ê¸°ê°„ 365ì¼)
- Subject Alternative Name (SAN) ì„¤ì •
- `./shelter_chatbot/cert/` ë””ë ‰í† ë¦¬ì— ì €ì¥

---

## ğŸ”„ ë³µí•© ì§ˆë¬¸ ì²˜ë¦¬ ê³¼ì • (ì˜ˆì‹œ)

### ì§ˆë¬¸: "ì§€ê¸ˆ ë‚´ê°€ í”Œë ˆì´ë°ì´í„° ì„œì´ˆìº í¼ìŠ¤ì— ìˆëŠ”ë° ë•…ì´ í”ë“¤ë¦¬ê³  ìˆì–´. ì§€ê¸ˆ ë‚´ê°€ ì–´ë–»ê²Œ í–‰ë™í•´ì•¼í•˜ëŠ”ì§€ ë˜ ì–´ë””ë¡œ ëŒ€í”¼í•´ì•¼í•˜ëŠ”ì§€ ì•Œë ¤ì¤˜"

#### ğŸ¬ ì „ì²´ ì²˜ë¦¬ íë¦„ [[ğŸ“Š ì¸í„°ë™í‹°ë¸Œ í”Œë¡œìš°ì°¨íŠ¸ ë³´ê¸°](./RAG%20ì±—ë´‡%20ì²˜ë¦¬%20ê³¼ì •.html)]

```
[1ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ (shelter_1.0.html)]
â”‚
â”œâ”€â”€ ì‚¬ìš©ìê°€ í…ìŠ¤íŠ¸ ì…ë ¥
â”œâ”€â”€ JavaScript: fetch(`POST /api/location/extract`, {query: "..."})
â”‚
â†“
â”‚
[2ë‹¨ê³„: FastAPI ì„œë²„ (main.py)]
â”‚
â”œâ”€â”€ `@app.post("/api/location/extract")` ì—”ë“œí¬ì¸íŠ¸ ì‹¤í–‰
â”œâ”€â”€ Request Body íŒŒì‹±: `LocationExtractRequest(query="...")`
â”œâ”€â”€ LangGraph Agent í˜¸ì¶œ:
â”‚   â””â”€â”€ langgraph_app.invoke({"messages": [HumanMessage(content=query)]})
â”‚
â†“
â”‚
[3ë‹¨ê³„: LangGraph Agent (langgraph_agent.py)]
â”‚
â”œâ”€â”€ ğŸ§  Node 1: intent_classifier_node
â”‚   â”œâ”€â”€ `intent_classification_prompt + llm` ì‹¤í–‰
â”‚   â”œâ”€â”€ ì§ˆë¬¸ ë¶„ì„:
â”‚   â”‚   - "í”Œë ˆì´ë°ì´í„° ì„œì´ˆìº í¼ìŠ¤" â†’ ìœ„ì¹˜ í‚¤ì›Œë“œ ê°ì§€
â”‚   â”‚   - "ë•…ì´ í”ë“¤ë¦¬ê³ " â†’ ì§€ì§„ í‚¤ì›Œë“œ ê°ì§€
â”‚   â”‚   - "í–‰ë™í•´ì•¼í•˜ëŠ”ì§€" + "ëŒ€í”¼í•´ì•¼í•˜ëŠ”ì§€" â†’ ë³µí•© ì˜ë„ ê°ì§€
â”‚   â””â”€â”€ ì˜ë„ ë¶„ë¥˜ ê²°ê³¼: "hybrid_location_disaster" (ìœ„ì¹˜ + ì¬ë‚œ)
â”‚
â”œâ”€â”€ ğŸ”„ Node 2: query_rewrite_node
â”‚   â”œâ”€â”€ `query_rewrite_prompt + llm` ì‹¤í–‰
â”‚   â”œâ”€â”€ BM25 ìµœì í™”ë¥¼ ìœ„í•œ ì¿¼ë¦¬ ì¬ì‘ì„±:
â”‚   â”‚   â””â”€â”€ "í”Œë ˆì´ë°ì´í„° ì„œì´ˆìº í¼ìŠ¤ ì§€ì§„ ëŒ€í”¼ì†Œ í–‰ë™ìš”ë ¹"
â”‚   â”‚       (ë¶ˆí•„ìš”í•œ ì¡°ì‚¬ ì œê±°, í•µì‹¬ í‚¤ì›Œë“œ ì¶”ì¶œ)
â”‚
â”œâ”€â”€ ğŸ¤– Node 3: agent_node
â”‚   â”œâ”€â”€ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ + ì‚¬ìš©ì ë©”ì‹œì§€ ê²°í•©
â”‚   â”œâ”€â”€ LLMì´ ì ì ˆí•œ ë„êµ¬ ì„ íƒ:
â”‚   â”‚   â””â”€â”€ `search_location_with_disaster(query)` ì„ íƒ
â”‚   â”‚       (ì´ìœ : ìœ„ì¹˜ + ì¬ë‚œì´ í•¨ê»˜ ìˆëŠ” ë³µí•© ì§ˆë¬¸)
â”‚
â”œâ”€â”€ ğŸ› ï¸ Node 4: tools_node (search_location_with_disaster ì‹¤í–‰)
â”‚   â”‚
â”‚   â”œâ”€â”€ [4-1] ì¬ë‚œ í‚¤ì›Œë“œ ì¶”ì¶œ
â”‚   â”‚   â”œâ”€â”€ "ë•…ì´ í”ë“¤ë¦¬ê³ " â†’ "ì§€ì§„" ê°ì§€
â”‚   â”‚   â””â”€â”€ detected_disaster = "ì§€ì§„"
â”‚   â”‚
â”‚   â”œâ”€â”€ [4-2] ìœ„ì¹˜ í‚¤ì›Œë“œ ì¶”ì¶œ
â”‚   â”‚   â”œâ”€â”€ ì§ˆë¬¸ì—ì„œ ì¬ë‚œ í‚¤ì›Œë“œ ì œê±°: "í”Œë ˆì´ë°ì´í„° ì„œì´ˆìº í¼ìŠ¤"
â”‚   â”‚   â””â”€â”€ location_query = "í”Œë ˆì´ë°ì´í„° ì„œì´ˆìº í¼ìŠ¤"
â”‚   â”‚
â”‚   â”œâ”€â”€ [4-3] Kakao Local API í˜¸ì¶œ
â”‚   â”‚   â”œâ”€â”€ GET https://dapi.kakao.com/v2/local/search/keyword.json
â”‚   â”‚   â”œâ”€â”€ params: {"query": "í”Œë ˆì´ë°ì´í„° ì„œì´ˆìº í¼ìŠ¤"}
â”‚   â”‚   â””â”€â”€ ì‘ë‹µ:
â”‚   â”‚       â”œâ”€â”€ place_name: "í”Œë ˆì´ë°ì´í„°"
â”‚   â”‚       â”œâ”€â”€ y (ìœ„ë„): 37.4979
â”‚   â”‚       â””â”€â”€ x (ê²½ë„): 127.0276
â”‚   â”‚
â”‚   â”œâ”€â”€ [4-4] ëŒ€í”¼ì†Œ ê²€ìƒ‰ (ChromaDB)
â”‚   â”‚   â”œâ”€â”€ vectorstore.get(where={"type": "shelter"})
â”‚   â”‚   â”œâ”€â”€ ëª¨ë“  ëŒ€í”¼ì†Œ ë©”íƒ€ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
â”‚   â”‚   â”œâ”€â”€ Haversine ê±°ë¦¬ ê³„ì‚°:
â”‚   â”‚   â”‚   â””â”€â”€ distance = haversine(37.4979, 127.0276, shelter.lat, shelter.lon)
â”‚   â”‚   â”œâ”€â”€ ê±°ë¦¬ìˆœ ì •ë ¬
â”‚   â”‚   â””â”€â”€ ê°€ì¥ ê°€ê¹Œìš´ 3ê³³ ì„ íƒ:
â”‚   â”‚       â”œâ”€â”€ 1. ì„œì´ˆêµ¬ë¯¼íšŒê´€ (0.5km)
â”‚   â”‚       â”œâ”€â”€ 2. ê°•ë‚¨ì—­ì§€í•˜ìƒê°€ (1.2km)
â”‚   â”‚       â””â”€â”€ 3. êµë³´íƒ€ì›Œ (1.5km)
â”‚   â”‚
â”‚   â”œâ”€â”€ [4-5] ì¬ë‚œ í–‰ë™ìš”ë ¹ ê²€ìƒ‰ (Hybrid Retriever)
â”‚   â”‚   â”œâ”€â”€ guideline_hybrid_retriever.invoke("ì§€ì§„")
â”‚   â”‚   â”œâ”€â”€ Vector Search (60%):
â”‚   â”‚   â”‚   â”œâ”€â”€ ì¿¼ë¦¬ ì„ë² ë”©: "ì§€ì§„" â†’ Vector[1536]
â”‚   â”‚   â”‚   â””â”€â”€ ìœ ì‚¬ë„ ê³„ì‚° â†’ ê´€ë ¨ Document ë°˜í™˜
â”‚   â”‚   â”œâ”€â”€ BM25 Search (40%):
â”‚   â”‚   â”‚   â”œâ”€â”€ í† í°í™”: ["ì§€ì§„"]
â”‚   â”‚   â”‚   â””â”€â”€ í‚¤ì›Œë“œ ë§¤ì¹­ â†’ ê´€ë ¨ Document ë°˜í™˜
â”‚   â”‚   â””â”€â”€ Ensemble ê²°ê³¼ (ìƒìœ„ 2ê°œ):
â”‚   â”‚       â”œâ”€â”€ Document 1: "ì§€ì§„ > ë°œìƒ ì‹œ > ì‹¤ë‚´\n- ì±…ìƒ ì•„ë˜ë¡œ ëŒ€í”¼\n- ë¬¸ ì—´ê¸°\n..."
â”‚   â”‚       â””â”€â”€ Document 2: "ì§€ì§„ > ë°œìƒ ì§í›„\n- ì—˜ë¦¬ë² ì´í„° ì‚¬ìš© ê¸ˆì§€\n..."
â”‚   â”‚
â”‚   â””â”€â”€ [4-6] í†µí•© ê²°ê³¼ ìƒì„±
â”‚       â””â”€â”€ return {
â”‚           "text": """
â”‚               ğŸš¨ í”Œë ˆì´ë°ì´í„° ê·¼ì²˜ ì§€ì§„ ë°œìƒ ì‹œ ëŒ€ì‘ ê°€ì´ë“œ
â”‚               
â”‚               ğŸ“ ê°€ì¥ ê°€ê¹Œìš´ ëŒ€í”¼ì†Œ 3ê³³
â”‚               1. ì„œì´ˆêµ¬ë¯¼íšŒê´€ (0.5km)
â”‚               2. ê°•ë‚¨ì—­ì§€í•˜ìƒê°€ (1.2km)
â”‚               3. êµë³´íƒ€ì›Œ (1.5km)
â”‚               
â”‚               ğŸš¨ ì§€ì§„ í–‰ë™ìš”ë ¹
â”‚               - ì±…ìƒ ì•„ë˜ë¡œ ëŒ€í”¼í•˜ì„¸ìš”
â”‚               - ë¬¸ì„ ì—´ì–´ ì¶œêµ¬ë¥¼ í™•ë³´í•˜ì„¸ìš”
â”‚               - ì—˜ë¦¬ë² ì´í„° ì‚¬ìš©ì„ ê¸ˆì§€í•©ë‹ˆë‹¤
â”‚               ...
â”‚               """,
â”‚           "structured_data": {
â”‚               "location": "í”Œë ˆì´ë°ì´í„°",
â”‚               "coordinates": (37.4979, 127.0276),
â”‚               "shelters": [
â”‚                   {"name": "ì„œì´ˆêµ¬ë¯¼íšŒê´€", "lat": 37.5000, "lon": 127.0300, "distance": 0.5, ...},
â”‚                   ...
â”‚               ]
â”‚           }
â”‚       }
â”‚
â†“
â”‚
[4ë‹¨ê³„: FastAPI ì„œë²„ (main.py) - ì‘ë‹µ ë°˜í™˜]
â”‚
â”œâ”€â”€ Agent ê²°ê³¼ì—ì„œ `structured_data` ì¶”ì¶œ
â”œâ”€â”€ `LocationExtractResponse` ìƒì„±:
â”‚   â”œâ”€â”€ success: True
â”‚   â”œâ”€â”€ location: "í”Œë ˆì´ë°ì´í„°"
â”‚   â”œâ”€â”€ coordinates: (37.4979, 127.0276)
â”‚   â”œâ”€â”€ shelters: [...]
â”‚   â””â”€â”€ message: "ğŸš¨ í”Œë ˆì´ë°ì´í„° ê·¼ì²˜ ì§€ì§„ ë°œìƒ ì‹œ ëŒ€ì‘ ê°€ì´ë“œ\n..."
â”‚
â””â”€â”€ JSON ì‘ë‹µ ë°˜í™˜
â”‚
â†“
â”‚
[5ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ (shelter_1.0.html) - UI ì—…ë°ì´íŠ¸]
â”‚
â”œâ”€â”€ JavaScript: response.json() íŒŒì‹±
â”œâ”€â”€ ì±„íŒ…ì°½ì— ë©”ì‹œì§€ ì¶œë ¥:
â”‚   â””â”€â”€ addMessage("bot", response.message)
â”‚
â””â”€â”€ Naver Maps API í˜¸ì¶œ:
    â”œâ”€â”€ map.setCenter(new naver.maps.LatLng(37.4979, 127.0276))
    â”œâ”€â”€ ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ìƒì„± (íŒŒë€ìƒ‰)
    â””â”€â”€ ëŒ€í”¼ì†Œ ë§ˆì»¤ ìƒì„± (ë¹¨ê°„ìƒ‰ - ê°€ì¥ ê°€ê¹Œìš´ ê³³)
        â”œâ”€â”€ ì„œì´ˆêµ¬ë¯¼íšŒê´€
        â”œâ”€â”€ ê°•ë‚¨ì—­ì§€í•˜ìƒê°€
        â””â”€â”€ êµë³´íƒ€ì›Œ
```
---

## ğŸ“Š ë°ì´í„° ë³€í™˜ ê³¼ì • ìƒì„¸

### CSV ë°ì´í„° ë³€í™˜ íë¦„

```
[ì›ë³¸: shelter.csv]
â”œâ”€â”€ ì»¬ëŸ¼: ì‹œì„¤ëª…, ë„ë¡œëª…ì „ì²´ì£¼ì†Œ, ìµœëŒ€ìˆ˜ìš©ì¸ì›, ìœ„ë„, ê²½ë„, ...
â”‚
â†“ load_shelter_csv()
â”‚
[pandas DataFrame]
â”œâ”€â”€ ê° í–‰ì´ ëŒ€í”¼ì†Œ 1ê³³
â”‚
â†“ csv_to_documents()
â”‚
[LangChain Document]
â”œâ”€â”€ page_content: "ë¯¼ë°©ìœ„ ëŒ€í”¼ ì‹œì„¤ XXì€ YYì— ìœ„ì¹˜í•´ ìˆìœ¼ë©°, ..."
â”œâ”€â”€ metadata:
â”‚   â”œâ”€â”€ type: "shelter"
â”‚   â”œâ”€â”€ facility_name: "ë™ëŒ€ë¬¸ë§¨ì…˜"
â”‚   â”œâ”€â”€ address: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ..."
â”‚   â”œâ”€â”€ lat: 37.5665
â”‚   â”œâ”€â”€ lon: 126.9780
â”‚   â”œâ”€â”€ capacity: 1500
â”‚   â””â”€â”€ ...
â”‚
â†“ OpenAI Embeddings
â”‚
[Vector: 1536ì°¨ì› ë¶€ë™ì†Œìˆ˜ì  ë°°ì—´]
â”‚
â†“ ChromaDB.add()
â”‚
[ChromaDB ì €ì¥]
â””â”€â”€ ì¸ë±ìŠ¤ ìƒì„±, ê²€ìƒ‰ ê°€ëŠ¥ ìƒíƒœ
```

### JSON ë°ì´í„° ë³€í™˜ íë¦„

```
[ì›ë³¸: *.json]
â”œâ”€â”€ ê³„ì¸µ êµ¬ì¡°:
â”‚   â”œâ”€â”€ ì¬ë‚œëª…
â”‚   â”œâ”€â”€ í–‰ë™ìš”ë ¹
â”‚   â”‚   â”œâ”€â”€ ë°œìƒ ì „
â”‚   â”‚   â”‚   â”œâ”€â”€ ì„¸ë¶€ì‚¬í•­: [...]
â”‚   â”‚   â”‚   â””â”€â”€ ì£¼ì˜ì‚¬í•­: [...]
â”‚   â”‚   â”œâ”€â”€ ë°œìƒ ì‹œ
â”‚   â”‚   â””â”€â”€ ë°œìƒ í›„
â”‚
â†“ load_disaster_json()
â”‚
[Python dict]
â”‚
â†“ json_to_documents() + parse_node() (ì¬ê·€ íƒìƒ‰)
â”‚
[LangChain Document]
â”œâ”€â”€ page_content: "ì§€ì§„ > ë°œìƒ ì‹œ > ì‹¤ë‚´\nì„¸ë¶€ì‚¬í•­:\n- ì±…ìƒ ì•„ë˜ë¡œ ëŒ€í”¼\n..."
â”œâ”€â”€ metadata:
â”‚   â”œâ”€â”€ type: "disaster_guideline"
â”‚   â”œâ”€â”€ category: "ìì—°ì¬ë‚œ"
â”‚   â”œâ”€â”€ keyword: "ì§€ì§„"
â”‚   â”œâ”€â”€ situation: "ë°œìƒ ì‹œ"
â”‚   â””â”€â”€ path: "ì§€ì§„ > ë°œìƒ ì‹œ > ì‹¤ë‚´"
â”‚
â†“ OpenAI Embeddings
â”‚
[Vector: 1536ì°¨ì› ë¶€ë™ì†Œìˆ˜ì  ë°°ì—´]
â”‚
â†“ ChromaDB.add()
â”‚
[ChromaDB ì €ì¥]
â””â”€â”€ ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ ê°€ëŠ¥
```

---

### ğŸ“ ê° íŒŒì¼ì˜ ì—­í•  ìš”ì•½

| íŒŒì¼ | ì—­í•  | ë¹„ìœ  |
|------|------|------|
| `data_loaders.py` | ì›ë³¸ ë°ì´í„° ì½ê¸° | ğŸ“‚ ì°½ê³ ì—ì„œ ì¬ë£Œ êº¼ë‚´ê¸° |
| `documents.py` | ë°ì´í„°ë¥¼ Documentë¡œ ë³€í™˜ | ğŸ³ ì¬ë£Œë¥¼ ìš”ë¦¬ ì¬ë£Œë¡œ ì†ì§ˆ |
| `embedding_and_vectordb.py` | ì„ë² ë”© ìƒì„± ë° ì €ì¥ | ğŸ“¦ ìš”ë¦¬ë¥¼ í¬ì¥í•´ì„œ ëƒ‰ì¥ê³ ì— ë³´ê´€ |
| `from_DataLoad_to_VectorDB.py` | ìœ„ 3ê°œë¥¼ í†µí•© ì‹¤í–‰ | ğŸš€ í•œ ë²ˆì— ì¤€ë¹„ ì™„ë£Œ |
| `langgraph_agent.py` | ìƒê°í•˜ëŠ” ë¡œì§ (ë‘ë‡Œ) | ğŸ§  ì…°í”„ì˜ ë ˆì‹œí”¼ì™€ ì¡°ë¦¬ ê¸°ìˆ  |
| `main.py` | API ì„œë²„ (ì–¼êµ´) | ğŸ‘¨â€ğŸ³ ì†ë‹˜ ì‘ëŒ€ ë° ì£¼ë¬¸ ë°›ê¸° |
| `shelter_1.0.html` | ì›¹ UI (ì†ë‹˜) | ğŸ½ï¸ ë ˆìŠ¤í† ë‘ í…Œì´ë¸” |

**ë¶„ë¦¬ ì´ìœ :**
- **ë¡œì§(langgraph_agent.py)**ê³¼ **UI(main.py)**ë¥¼ ë¶„ë¦¬í•´ì•¼:
  - ë””ë²„ê¹…ì´ ì‰¬ì›€ (ë¡œì§ ì˜¤ë¥˜ vs UI ì˜¤ë¥˜ êµ¬ë¶„)
  - í™•ì¥ì´ í¸í•¨ (ì¹´ì¹´ì˜¤í†¡ ë´‡, í…”ë ˆê·¸ë¨ ë´‡ ë“±ìœ¼ë¡œ UI êµì²´ ê°€ëŠ¥)
  - ì¬ì‚¬ìš© ê°€ëŠ¥ (ê°™ì€ Agentë¥¼ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©)

---

## âš™ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### LangGraph Agent êµ¬ì¡°

```python
[ì‚¬ìš©ì ì¿¼ë¦¬]
    â†“
[Intent Classifier Node]  # GPT-4o-mini ê¸°ë°˜ ì˜ë„ ë¶„ë¥˜
    â†“
[Query Rewrite Node]  # BM25 ìµœì í™”ë¥¼ ìœ„í•œ ì¿¼ë¦¬ ì¬ì‘ì„±
    â†“
[Agent Node]  # ë„êµ¬ ì„ íƒ ë° ì‹¤í–‰ ê³„íš
    â†“
[Tools Execution]  # 7ê°€ì§€ ë„êµ¬ ì¤‘ ì„ íƒ
    â”œâ”€ search_shelter_by_location
    â”œâ”€ search_shelter_by_name
    â”œâ”€ search_location_with_disaster
    â”œâ”€ count_shelters
    â”œâ”€ search_shelter_by_capacity
    â”œâ”€ search_disaster_guideline
    â””â”€ answer_general_knowledge
    â†“
[Response Generation]  # êµ¬ì¡°í™”ëœ ë°ì´í„° ë°˜í™˜
    â†“
[FastAPI Response]  # JSON í˜•ì‹
    â†“
[HTML UI + Naver Maps]  # ì‹œê°í™”
```

### í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ êµ¬ì¡°

```python
[ì‚¬ìš©ì ì¿¼ë¦¬]
    â†“
[Ensemble Retriever]
    â”œâ”€ [Vector Retriever] (Weight: 0.6~0.7)
    â”‚   â””â”€ OpenAI Embeddings + ChromaDB
    â”‚
    â””â”€ [BM25 Retriever] (Weight: 0.3~0.4)
        â””â”€ í† í° ê¸°ë°˜ í‚¤ì›Œë“œ ë§¤ì¹­
    â†“
[ê²°ê³¼ í†µí•© ë° ì¤‘ë³µ ì œê±°]
    â†“
[Top-K ë¬¸ì„œ ë°˜í™˜]
```

---

## ğŸ”§ API ì—”ë“œí¬ì¸íŠ¸

### 1. POST `/api/location/extract`
**ì‚¬ìš©ì ì§ˆì˜ë¥¼ LangGraph Agentê°€ ì²˜ë¦¬**

**Request:**
```json
{
  "query": "ê°•ë‚¨ì—­ ê·¼ì²˜ ëŒ€í”¼ì†Œ"
}
```

**Response:**
```json
{
  "success": true,
  "location": "ê°•ë‚¨ì—­",
  "coordinates": [37.4979, 127.0276],
  "shelters": [
    {
      "name": "ê°•ë‚¨ì—­ì§€í•˜ìƒê°€",
      "address": "ì„œìš¸ ê°•ë‚¨êµ¬ ê°•ë‚¨ëŒ€ë¡œ ì§€í•˜396",
      "lat": 37.4979,
      "lon": 127.0276,
      "distance": 0.12,
      "capacity": 5000
    }
  ],
  "total_count": 5,
  "message": "ê°•ë‚¨ì—­ ê·¼ì²˜ ëŒ€í”¼ì†Œ 5ê³³ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤."
}
```

### 2. GET `/api/shelters/nearest`
**í˜„ìœ„ì¹˜ ê¸°ì¤€ ê°€ì¥ ê°€ê¹Œìš´ ëŒ€í”¼ì†Œ ê²€ìƒ‰**

**Query Parameters:**
- `lat`: ìœ„ë„ (float)
- `lon`: ê²½ë„ (float)
- `k`: ë°˜í™˜ ê°œìˆ˜ (int, default=5)

### 3. GET `/api/health`
**ì„œë²„ ìƒíƒœ í™•ì¸**

### 4. GET `/api/status`
**ìƒì„¸ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸**

---


## ğŸ”— ì›¹ ì±—ë´‡ ì„œë¹„ìŠ¤

| ì„œë¹„ìŠ¤ | ì ‘ì† ë§í¬ |
|--------|-----------|
| ë¯¼ë°©ìœ„ ëŒ€í”¼ì‹œì„¤ Â· ì¬ë‚œ í–‰ë™ìš”ë ¹ ì‹¤ì‹œê°„ ì§ˆì˜ì‘ë‹µ ì±—ë´‡ | ğŸ”— **https://183.98.34.111:8443/** |

## ğŸ–¥ ì‹¤í–‰ í™”ë©´

<p align="center">
  <img src="./image/ì‹¤í–‰í™”ë©´.png" width="900"/>
</p>


## ğŸ¯ ì œê³µ ê¸°ëŠ¥

### 1. ìœ„ì¹˜ ê¸°ë°˜ ëŒ€í”¼ì†Œ ê²€ìƒ‰
- **GPS í˜„ìœ„ì¹˜ ê²€ìƒ‰**: "í˜„ìœ„ì¹˜" ë˜ëŠ” GPS ë²„íŠ¼ í´ë¦­
- **ì§€ëª… ê²€ìƒ‰**: "ê°•ë‚¨ì—­ ê·¼ì²˜ ëŒ€í”¼ì†Œ"
- **ì£¼ì†Œ ê²€ìƒ‰**: "ì„œìš¸ì‹œ ì¤‘êµ¬ ëª…ë™"
- **ê±´ë¬¼ëª… ê²€ìƒ‰**: "ë¡¯ë°ì›”ë“œ ì£¼ë³€"

### 2. ì‹œì„¤ëª… ì§ì ‘ ê²€ìƒ‰
- "ë™ëŒ€ë¬¸ë§¨ì…˜ ìˆ˜ìš©ì¸ì›"
- "ì„œìš¸ì—­ ëŒ€í”¼ì†Œ ì •ë³´"

### 3. ë³µí•© ì§ˆë¬¸ ì²˜ë¦¬ (ìœ„ì¹˜ + ì¬ë‚œ)
- "ì„¤ì•…ì‚° ê·¼ì²˜ì¸ë° ì‚°ì‚¬íƒœ ë°œìƒ ì‹œ"
- "ê°•ë‚¨ì—­ì—ì„œ ì§€ì§„ ë‚˜ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•´?"
- "ëª…ë™ í™”ì¬ ë‚¬ì„ ë•Œ ëŒ€í”¼ì†Œ"

### 4. ì¬ë‚œ í–‰ë™ìš”ë ¹
- "ì§€ì§„ ë°œìƒ ì‹œ í–‰ë™ìš”ë ¹"
- "í™”ì¬ ì‹ ê³  ë°©ë²•"
- "í™ìˆ˜ ëŒ€ë¹„ ë°©ë²•"

### 5. í†µê³„ ë° ë¶„ì„
- "ì„œìš¸ ì§€í•˜ ëŒ€í”¼ì†Œ ëª‡ ê°œ?"
- "1000ëª… ì´ìƒ ìˆ˜ìš© ê°€ëŠ¥í•œ ëŒ€í”¼ì†Œ"

### 6. ì‹¤ì‹œê°„ ì§€ë„ ì‹œê°í™”
- Naver Maps APIë¥¼ í†µí•œ ëŒ€í”¼ì†Œ ë§ˆì»¤ í‘œì‹œ
- ì‚¬ìš©ì ìœ„ì¹˜ í‘œì‹œ
- ê±°ë¦¬ ê¸°ë°˜ ì •ë ¬ (ê°€ì¥ ê°€ê¹Œìš´ ëŒ€í”¼ì†Œ ê°•ì¡°)
- InfoWindowë¥¼ í†µí•œ ìƒì„¸ ì •ë³´ í‘œì‹œ

---

## ğŸ“Š ë°ì´í„° êµ¬ì¡°

### ëŒ€í”¼ì†Œ ë°ì´í„° (CSV)
```python
{
    "type": "shelter",
    "facility_name": "ë™ëŒ€ë¬¸ë§¨ì…˜",
    "address": "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„ì§€ë¡œ 281",
    "lat": 37.5665,
    "lon": 126.9780,
    "capacity": 1500,
    "shelter_type": "ì§€í•˜",
    "facility_type": "ë¯¼ë°©ìœ„"
}
```

### ì¬ë‚œ í–‰ë™ìš”ë ¹ (JSON)
```python
{
    "type": "disaster_guideline",
    "category": "ìì—°ì¬ë‚œ",
    "keyword": "ì§€ì§„",
    "situation": "ë°œìƒ ì§í›„",
    "path": "ì§€ì§„ > ë°œìƒ ì§í›„ > ì‹¤ë‚´",
    "ì„¸ë¶€ì‚¬í•­": ["ì±…ìƒ ì•„ë˜ë¡œ ëŒ€í”¼", "ë¬¸ ì—´ê¸°", ...],
    "ì£¼ì˜ì‚¬í•­": ["ì—˜ë¦¬ë² ì´í„° ì‚¬ìš© ê¸ˆì§€", ...]
}
```

---

## ğŸ“¦ ì‚°ì¶œë¬¼ ì •ë¦¬

| ìš”êµ¬ ì‚°ì¶œë¬¼ | ì œê³µ í•­ëª© |
|------------|-----------|
| ìˆ˜ì§‘ëœ ë°ì´í„° ë° ì „ì²˜ë¦¬ | `data/` í´ë” ë° Document ë³€í™˜ ëª¨ë“ˆ |
| ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ | LangGraph Agent + Hybrid Search ë‹¤ì´ì–´ê·¸ë¨ |
| ê°œë°œëœ ì†Œí”„íŠ¸ì›¨ì–´ | Python ìŠ¤í¬ë¦½íŠ¸ 8ì¢… + HTML ì›¹ UI |
| ë°°í¬ í™˜ê²½ | FastAPI HTTPS ì„œë²„ + ì™¸ë¶€ ì ‘ì† URL |
| VectorDB | ChromaDB ì˜êµ¬ ì €ì¥ì†Œ |
| API ë¬¸ì„œ | FastAPI ìë™ ìƒì„± (Swagger UI) |

---

## ğŸŒ± í–¥í›„ ê°œì„  ê³„íš

- [ ] ì‚¬ìš©ì ìœ„ì¹˜ ê¸°ë°˜ ëŒ€í”¼ì†Œ ì¶”ì²œ ê°•í™”
- [ ] ì¹´í…Œê³ ë¦¬ë³„ ëŒ€í”¼ì†Œ í•„í„°ë§ (ì¥ì• ì¸, ìœ ì•„, ë°˜ë ¤ë™ë¬¼ ë“±)
- [ ] Retrieval Routing (ì˜ë„ë³„ ê²€ìƒ‰ ì „ëµ ìµœì í™”)
- [ ] RAG í‰ê°€ ì§€í‘œ ì ìš© (RAGAS)
- [ ] ì›¹ ê²€ìƒ‰ API í†µí•© (Tavily)
- [ ] ì‹¤ì‹œê°„ ì¬ë‚œ ì•Œë¦¼ ì‹œìŠ¤í…œ
- [ ] ë‹¤êµ­ì–´ ì§€ì› (ì˜ì–´, ì¤‘êµ­ì–´, ì¼ë³¸ì–´)

---

## ğŸ“ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” SK Networks Family 20ê¸° AI êµìœ¡ ê³¼ì •ì˜ ì¼í™˜ë¡œ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ™ ì†Œê°

- **ê¹€í™©í˜„** - ì´ë²ˆì—ë„ ì£¼ì œ ì„ ì •ì— ì–´ë ¤ì›€ì´ ìˆì—ˆì§€ë§Œ ì£¼ì œ ì„ ì • í›„ ë‹¤ë“¤ ë§¡ì€ ì—…ë¬´ë¥¼ ì—´ì‹¬íˆ í•˜ì—¬ ê³ ìƒì€ í–ˆì§€ë§Œ ì¬ë°Œê²Œ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤.
- **ë¬¸ì°½êµ** - ëª¨ë‘ê°€ ì—´ì‹¬íˆ í•´ì¤€ ë•ë¶„ì— ë‚˜ë¦„ ë§Œì¡±í• ë§Œí•œ ê²°ê³¼ê°€ ë‚˜ì˜¨ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ëª¨ë‘ ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.
- **ê¹€íš¨ë¹ˆ** - í”„ë¡œì íŠ¸ ê³¼ì • ë™ì•ˆ ì •ë§ ë§ì´ ë°°ìš°ê³  LLMì˜ ì „ì²´ì ì¸ ê³¼ì •ì„ ì´í•´í•  ìˆ˜ ìˆëŠ” ìœ ìµí•œ ì‹œê°„ì´ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤ !
- **ê¶Œê·œë¦¬** - ë§‰ì—°í—€ë˜ llmê³¼ ragì˜ ì—°ê´€ì„±ì„ ê´€ê³„ë¥¼ ì´ë¡ ì ìœ¼ë¡œë§Œ ë“£ë‹¤ê°€ ì§ì ‘ íŒ€ì›ë“¤ì´ ì„¤ëª…í•´ì£¼ëŠ” ê²ƒ ë“¤ìœ¼ë©´ì„œ ì´í•´í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë•ë¶„ì— ë§ì´ ë°°ìš¸ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
- **ì´ìŠ¹ê·œ** - ìˆ˜ì—…ì‹œê°„ì— ì´í•´í•˜ì§€ ëª»í–ˆë˜ ê²ƒë“¤ì´ ì°¨ê·¼ì°¨ê·¼ ì´í•´ê°€ ë˜ë©´ì„œ ì „ì²´ íŒŒì´í”„ë¼ì¸ê³¼ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ê¹Šì´ìˆëŠ” ì´í•´ê°€ ê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤. ë„ˆë¬´ ì¬ë°‹ì–´ìš”!

---

<p align="center">
  <img src="https://capsule-render.vercel.app/api?type=wave&height=100&color=0:FFD86F,50:FFAA28,100:FF6B00&section=footer" />
</p>
